> Thanks now do research incer online had their mouselook with action combat. That’s what I want our default setup to be, with support for optional different setups too. Figure that out and modify the above GitHub issue or write a new one and tell me if it’s supplemental or replaces it.


Great question. I dug up how **Neverwinter Online** handled its default “action combat + mouselook” setup and mapped it to our plan.

### What Neverwinter actually did (relevant bits)

* **Constant mouselook with a reticle** (no soft-target click-to-cast): you aim with the camera; **At‑Will** powers are bound to **LMB** and **RMB**; **Encounter** powers on **Q/E** (and sometimes **R** depending on era/class). ([Reddit][1])
* **ALT to free the cursor** for UI/map, i.e., toggle out of mouselook into cursor mode (numerous player/CS threads call this out). ([Microsoft Learn][2])
* **Shift** is the class mobility/guard key (e.g., dodge/teleport for Control Wizard; guard for Guardian Fighter) and **Tab** is the class mechanic / stance. (Documented in early control write‑ups; varies by class but the pattern is consistent.) ([Reddit][1])

These references are older (Neverwinter’s defaults shifted slightly over time), but they capture the **core pattern** we want as our default: **reticle‑aimed action combat with persistent mouselook**, a quick **ALT** escape to cursor mode for UI, and **LMB/RMB as primary attacks**.

---

## How this affects our issues

Rather than replacing the general controller/camera issue you asked for earlier, I suggest we **add a focused sub‑issue** that nails the exact interaction model and input mappings (Neverwinter‑style) and leaves the broader architecture intact.

* **New sub‑issue (supplemental):** `#95E1 — Action Combat & Mouselook (Neverwinter‑style default)`.
  This **supplements** the broader `95E — Client: Character Controller, Mouse Look, Camera & Accessibility (v1)` by providing concrete defaults, modes, bindings, and acceptance criteria. `95E` remains the architecture/system that hosts it.

Below is a ready‑to‑paste GitHub issue.

---

# 95E1 — Action Combat & Mouselook (Neverwinter‑style default)

**Labels:** client, input, camera, UX, accessibility
**Depends on:** 95B (client_core scaffold), 95E (controller/camera systems)
**Type:** Feature (supplements 95E; does not replace)

### Intent

Adopt a **Neverwinter‑style action combat** baseline: **persistent mouselook with a center reticle**, **LMB/RMB for at‑will powers**, **ALT to free the cursor** for UI, and class actions on **Shift/Tab**—while providing optional alternate schemes.

**Research basis:**
Neverwinter preview controls documented reticle targeting with constant mouselook; **At‑Will** on **LMB/RMB**; **Encounter** on **Q/E**; **Shift** for mobility/guard; **Tab** for class mechanic. ALT toggles cursor for UI. ([Reddit][1])

---

## Scope & Outcomes

**Default mode (“Action/Reticle”):**

* **Mouse is locked** (pointer‑lock) while in gameplay; **center reticle** visible.
* **LMB / RMB** fire the current **At‑Will** abilities.
* **Q/E/R** trigger **Encounter** abilities (configurable per class/spec).
* **Shift**: class mobility/guard (dodge, blink, guard, etc.).
* **Tab**: class stance/mechanic (class‑specific ability bar).
* **ALT**: **toggle (or hold‑to‑hold)** **Cursor Mode** — unlock cursor, hide reticle; UI is interactive; gameplay inputs suppressed except movement.
* **Casting while moving** supported by default; LoS is authoritative; “out of range” minimized (use **reticle + range feedback**, not click‑targeting).

**Optional modes (user‑selectable):**

* **Classic Cursor**: cursor default; **hold RMB** → mouselook + reticle; LMB remains UI click unless in mouselook.
* **Toggle vs Hold** for ALT (cursor unlock).
* **Accessibility**: jump‑to‑target assist (cone/aim assist threshold), enlarged reticle, high‑contrast reticle, reduced camera sway.

**Networking / ECS** (ties to 95E & Phase 2):
Client never mutates gameplay; it emits **InputCommand** events (`AtWillLMBDown/Up`, `AtWillRMBDown/Up`, `Encounter(Q/E/R)`, `Dodge`, `ClassMechanic`, `CursorToggle`, `LookDelta`). Server performs validation, GCD, LoS/range, and authoritative results.

---

## Design

### Client state machine (client_core)

* **MouseMode**: `{ Mouselook, Cursor }`
* **CombatMode**: `{ Idle, Casting, Releasing }` (for charge‑ups/channeling)
* **InputMapping** (profile’d): `ActionReticleDefault`, `ClassicCursor`, `Custom`
* **ControllerState**:

  * `yaw`, `pitch` (quats)
  * `reticle_world` (ray from camera)
  * flags: `is_sprinting`, `is_dodging`, `is_guarding`, `in_cursor_mode`
* **Systems**

  * `MouselookSystem`: consumes raw mouse deltas when `MouseMode::Mouselook` and produces yaw/pitch deltas; integrates dead‑zone clamp + sensitivity.
  * `CursorToggleSystem`: ALT press/release transitions; pointer‑lock acquire/release (Desktop: winit; WASM: Pointer Lock API).
  * `CameraFollowSystem`: applies yaw/pitch to camera rig, optional recoil/sway.
  * `ReticleSystem`: screen‑space reticle draw + states (green=in‑range/LoS, red=blocked, gray=cooldown).
  * `ActionBindingSystem`: maps LMB/RMB/Q/E/R to `InputCommand` messages; respects Cursor Mode (UI wins) and cooldown/GCD hints from replication.

### Renderer integration (render_wgpu)

* **No gameplay mutation**; reads **ControllerState** and renders reticle/HUD.
* Applies camera transforms fed by `client_core`.
* Uses “upload job” interface (from 95E) to keep GPU updates off the input path.

### Server tie‑ins (server_core)

* Consumes `InputCommand` events; runs class pipeline (2b) + projectile/collision/carve (Phase 2).
* Returns authoritative results; client predicts only **pose and VFX** (optional).

---

## Input Defaults (Neverwinter‑style)

* **LMB/RMB**: At‑Will 1/2. ([Reddit][1])
* **Q/E/R**: Encounter 1/2/(3). ([Reddit][1])
* **Shift**: Dodge/Teleport/Guard (class‑dependent). ([Reddit][1])
* **Tab**: Class mechanic/stance. ([Reddit][1])
* **ALT**: Toggle/hold Cursor Mode (UI control). ([Microsoft Learn][2])

> Note: We’ll ship these as **defaults** with full rebind support; classes can remap behaviors via SpecDb.

---

## Tasks

### 1) client_core: Controller & Modes

* [ ] `client_core/src/systems/mouselook.rs`: pointer‑lock capture, delta → yaw/pitch; clamps & sensitivity.
* [ ] `client_core/src/systems/cursor_toggle.rs`: ALT toggle/hold; integrate with winit + WASM pointer‑lock.
* [ ] `client_core/src/systems/camera.rs`: follow rig; exposes `CameraPose`.
* [ ] `client_core/src/systems/reticle.rs`: reticle state + HUD hooks (color, size, LoS/hit feedback).
* [ ] `client_core/src/systems/action_bindings.rs`: map LMB/RMB/Q/E/R/Shift/Tab to `InputCommand`s; respect Cursor Mode.
* [ ] `client_core/src/input/mappings.rs`: `ActionReticleDefault` + `ClassicCursor` + serialization for custom profiles.

### 2) data_runtime: Controller Config

* [ ] `configs/input_camera.toml`: sensitivity, invert Y, hold vs toggle for ALT, FOV, recoil/sway amounts, reticle settings (size, contrast).
* [ ] Loader & unit tests.

### 3) render_wgpu: HUD & Camera

* [ ] `gfx/ui/reticle.rs`: simple reticle widget reading `client_core` state (green/red/gray states).
* [ ] Wire camera to `client_core::CameraPose` (remove direct yaw from renderer).
* [ ] (Optional) vignette during sprint/charge; accessibility high‑contrast reticle mode.

### 4) server_core: Commands (glue to Phase 2/2b)

* [ ] Define `InputCommand` enum in shared module (or `ecs_core` newtype): `AtWillLMB{Down,Up}`, `AtWillRMB{Down,Up}`, `Encounter(Q/E/R)`, `Dodge`, `ClassMechanic`, `LookVec`, `MoveVec`.
* [ ] Accept commands; log (or telemetry) counts; no gameplay mutations here (handled by Phase 2/2b systems).

### 5) Settings & Rebind UI (minimal)

* [ ] Add a small in‑game settings pane (UX/HUD) to switch **Input Profile** (ActionReticle vs ClassicCursor), change **ALT mode** (hold vs toggle), adjust **sensitivity/FOV**, and **reticle style**.

### 6) WASM/Desktop Parity

* [ ] Desktop: winit pointer‑lock; WASM: web pointer‑lock + escape fallback (show helper tooltip if lock fails).
* [ ] Fail‑safe: if pointer‑lock denied, fallback to **Classic Cursor** (RMB hold to look).

---

## Telemetry (hooks only; ties to Issue “95T — Telemetry & Observability”)

* Emit counters for:

  * `controller.mode_transitions{from,to}`, `cursor_toggle{hold,toggle}`
  * `cast_input` vs `cast_authorized` (server confirmation)
  * `reticle_los_blocked` (how often players try to cast blocked)
* Latency markers: client input → server ack (Phase 3 replication).

---

## Acceptance Criteria

**Default (Action/Reticle)**

* On spawn, mouse is locked; reticle visible.
* ALT toggles to cursor (reticle hidden, UI interactable); ALT again returns to mouselook.
* LMB/RMB fire at‑will messages while moving; **no click‑to‑target** needed.
* Q/E/R send encounter commands; Shift sends dodge/guard; Tab sends class mechanic.
* Reticle color: green (LoS/in‑range feedback available), red (blocked), gray (cooldown) — driven by replicated state or client hints.
* Desktop and WASM both work; if pointer‑lock fails, fallback mode is available and communicated.

**Options**

* Classic Cursor profile selectable and persisted.
* ALT behavior configurable (hold/toggle); sensitivity/FOV persisted.

**Non‑goals (for this issue)**

* Full class pipelines, prediction/reconciliation, and ability trees (covered in Phase 2/2b).
* Advanced aim assist beyond cone/threshold.

---

## Risks & Mitigations

* **Pointer‑lock failures (browser/OS):** robust fallback (Classic Cursor) + tooltip prompt.
* **Accessibility needs:** ship high‑contrast reticle & larger sizes; expose sensitivity range in config.
* **International keybinds:** read layout from winit; offer immediate rebind UI.

---

### Why supplemental (not a replacement)?

`95E` defines **where** controller and camera live and how they integrate with the renderer/network stack. **This** issue nails the **interaction model and defaults** (Neverwinter‑style) + concrete bindings and acceptance tests. Keeping them separate helps code owners land architecture first (95E), then finalize UX defaults (95E1) with room for alt profiles.

If you’d rather track it as a single item, we can **merge 95E1 into 95E** and mark the above as an “Acceptance: Neverwinter defaults” section. I lean toward keeping it **supplemental** so we can iterate bindings without reopening the architectural issue.

---

If you want, I’ll also add a short “Neverwinter Controls (sources)” paragraph to the issue body with the three links so reviewers have context:

* TenTonHammer preview (reticle + LMB/RMB + Q/E + Shift/Tab). ([Reddit][1])
* Click to Cast blog (At‑Wills on LMB/RMB). ([dlassets-ssl.xboxlive.com][3])
* Microsoft Q&A thread (ALT frees cursor in Neverwinter). ([Microsoft Learn][2])

[1]: https://www.reddit.com/r/Neverwinter/comments/1df1mz/l_and_r_mouse_buttons/?utm_source=chatgpt.com "L and R mouse buttons. : r/Neverwinter"
[2]: https://learn.microsoft.com/en-us/answers/questions/4085160/need-help-with-mouse-in-neverwinter "Need help with mouse in Neverwinter. - Microsoft Q&A"
[3]: https://dlassets-ssl.xboxlive.com/public/content/0b94d2a2-180b-4b80-a157-2e396d567cb2/GameManual/eed1edb8-4745-4093-9fd6-37a2b416c5d6/nl-BE/index.html?utm_source=chatgpt.com "Neverwinter - Xbox Live"
